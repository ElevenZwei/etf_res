# 滑点分析和监控  

交易的滑点可以从几种不同的逻辑来理解。  

微观上有几种不同的价格，我们先把它列举出来。
1. 在回测中的理想价格。  
2. 在下单中的逐笔成交价格。  
3. 成交的平均价格。  
4. 下单时间段内的中间价。  
5. 下单时间段内的第一档吃单价格。  
6. 下单时间段内的盘口价差。  

当我们度量滑点的时候，我们可以从几种不同的视角来思考。  
1. 下单时的中间价和成交价差异  
2. 下单时的第一档和成交价差异  
3. 成交价格和回测采样价格的差异  
4. 下单时间段里的中间价波动范围，分布情况。  

滑点的统计从这几个不同的角度可以做成不同的项目。  
从重要性上面来说，首当其冲是成交价格和回测采样价格的差异。  

## 回测一致性分析  
按照 20250923 调查的经验，这个过程需要聚合成交记录。聚合的规则可以明确地给出。聚合成交记录之后和 Nautilus 回测的采样价格进行比对，其实也不需要 Nautilus ，应该说和那个时候的 Close 价格直接比对。  
现在从 Yuanlan 服务器导出 Option 市场价格的这一步还没有自动化，今天先写一个脚本把这一块补全了。  
Nautilus 应该做一个只输入一天的信号得到一天的交易记录的衍生脚本。  

导出市场价格本来的脚本在 DBeaver Script-12.sql 文件里面。冷启动导出一天的数据大概需要 45s，批量的话会有一些优化，大概可以降低到一天 10s ，但是批量数据的下载需要耗费不少时间。想要解决这个导出数据太慢的问题还是需要依靠新版的 Record 系统，它自带有分钟聚合功能，可以大大减少数据的计算量。  
导出市场价格之后的操作有 downsample 和 greeks ，这两个处理的脚本都是在 159915_2025.py 里面完成的。这个脚本会把下一分钟的 first trade price 视作上一分钟的 close price，我感觉这个逻辑有一点点问题。就是上一分钟可以窥见下一分钟的第一个交易。但是好在这个只是影响交易价格，我们并不从这个价格里面计算交易信号。所以不会有未来函数。  

假设我们得到了 Nautilus 的交易记录，和实盘交易记录，我应该如何比对分析？  
首先是比对交易的品种是否一致，然后是时间匹配，再是价格匹配。  
一切都太依赖新版的 Record 系统了。


## 下单价格与盘口差异  
我觉得这个部分应该放在交易系统以外的组件里面完成，交易系统的功能应该是非常明确的，上传仓位，交易记录，这样的功能。



