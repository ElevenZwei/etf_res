# 20251009 故障情况调查  

## 概要  
在 10 月 9 日，国庆节后开盘的第一天，下午出现了市场数据掉线的问题，导致没有录制数据，没有计算交易信号，也没有触发收盘时候的平仓。  
导致期权合成多头过夜仓位，在第二天开盘跳空下跌平仓的时候造成了不必要的几千元损失。  

## 过程  
在 13:04 的时候，1810 1915 账号交易程序、行情录制程序的连接全部断开。  

1810 和 1915 账号的 Market Data 和 Trader 在 13:04:55 之后就不再收到新的数据回报，在 13:07:57 的时候触发断开事件。  
随后在 13:10:16 的时候恢复了连接。Trader 重新完成了初始化过程。  
但是 Market Data 没有恢复订阅，导致程序没有去响应新的市场信号。  
1810 和 1915 在 13:04 之后没有启动新的交易。  

但是模拟盘的 Trader 没有掉线，只有 Market Data 掉线。  
所以我觉得问题在于 Huaxin 的堡垒机出现了网络中断，中断了大概 6 分钟。

## 解决办法
为此我们可以设置几种保险，  
一个是 Market Data 本身的初始化功能的修复。  
一个是 Market Data 没有收到任何行情可能需要触发不同的事件。  
我们思考一下如何响应这种事件比较合理。  

对于 Market Data 的失联，
比如说我们设计三个层次的方案：  
1. 自动重启，看看重启之后能否恢复市场数据响应。  
2. 要求人工介入，产生通知要求人工中止交易程序。  
3. 人工介入请求在一段时间里没有响应的话，例如 15 分钟，那么自动清仓。  


衍生出一个隐患，是我对于这种随机掉线事件的测试缺失，如果遇到了随机的组件掉线，怎样设计更加合理呢？  



# 20251010 未平仓问题调查  

## 概要  
在 10 月 10 日，1915 账号和模拟盘账号都出现了一些未平仓的仓位，尽管 spirit position 表格显示仓位应当归零。  
这个问题是股票信号逐级写入的过程里，SpiritCatcher 拒绝了接近收盘时候的仓位更改。  

## 解决办法
为此我们应该增加一个关于信号有效时间的设置选项，在股票信号输入的时候应该放宽到 57 分。  
同时监控面板分割成三块，一块是目标仓位，一块是改变值，一块是实际执行的差异值。

